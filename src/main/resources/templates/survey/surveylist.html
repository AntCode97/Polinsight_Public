<th:block>
  <div class="main_survey_list_wrap">
    <div class="main_survey_list_title">
      <p>ì§„í–‰ì¤‘ì¸ <span class="pol_color">ì˜¨ë¼ì¸ì¡°ì‚¬</span></p>
      <span>í´ì¸ì‚¬ì´íŠ¸ì—ì„œ í˜„ì¬ ì§„í–‰ì¤‘ì¸ ì˜¨ë¼ì¸ì¡°ì‚¬ë¥¼ ì†Œê°œí•´ë“œë¦½ë‹ˆë‹¤.</span>
    </div>
    <div class="search_survey_wrap">
      <div>

        <select name="survey_search_option" id="survey_search_option">
          <option value="title" selected>ì œëª©</option>
          <option value="point">í¬ì¸íŠ¸</option>
          <!--          <option value="end_date">ì¢…ë£Œì¼</option>-->
        </select>
      </div>
      <div class="search_input_wrap">
        <input name="searchInput" placeholder="ì„¤ë¬¸ ì œëª©ìœ¼ë¡œ ê²€ìƒ‰" type="text">
      </div>
      <div class="search_btn_wrap">
        <button id="survey_search_btn" value="">ğŸ”ì°¾ê¸°</button>
      </div>
    </div>
    <div class="main_survey_box">
    </div>
  </div>
  </body>
  <script>

    const makeSurveyCard = (survey) => {
      let template = ""
      if (survey.isRun) {
        template += '<div class=\"main_survey_item bg_color_item_white\">';
        template += '<p class="survey_run">ì§„í–‰ì¤‘</p>'
      } else {
        template += '<div class="main_survey_item bg_color_item_gray">';
        template += '<p class="survey_stop">ì¡°ì‚¬ì™„ë£Œ</p>'
      }
      template += '<p class="survey_title">' + survey.title + '</p>'
      template += '<p class="survey_point">' + !survey.point ? `ì§€ì • ì•ˆë¨</p>` : `${survey.point}+ P</p>`
      template += '<p class="survey_date">' + !survey.endAt ? `ì§€ì • ì•ˆë¨</p>` : `~ ${survey.endAt}</p>`
      template += '</div>'
      return template;
    }
    const makeSurveyCardList = (surveyList) => {
      const survey_box = $(".main_survey_box");
      let item_wrap = survey_box.find(".main_survey_item_wrap:last-child")
      survey_box.append('<div class="main_survey_item_wrap"></div>')
      for (idx in surveyList) {
        if (!!surveyList[idx].point)
          if (idx % 3 !== 0) {
            item_wrap.append(makeSurveyCard(surveyList[idx]))
          } else {
            survey_box.append('<div class="main_survey_item_wrap"></div>')
            item_wrap = survey_box.find(".main_survey_item_wrap:last-child")
            item_wrap.append(makeSurveyCard(surveyList[idx]))
          }
      }
    }

    const getSurveyList = () => {
      axios.get('/api/surveys')
          .then(res => {
            if (res.data.data !== null) {
              surveys = res.data.data
              if (surveys.length > 0) {
                makeSurveyCardList(surveys)
              } else {

              }
            }
          })
          .catch(err => console.log(err))
    }


    const asyncSurveySearch = () => {
      // ì„œë² ì´ ìš”ì†Œ ë¹„ìš°ê¸°
      const survey_box = $('.main_survey_box')
      const input = $('input[name=searchInput]')
      survey_box.empty()
      // ê²€ìƒ‰ íƒ€ì… ê°€ì ¸ì˜¤ê¸°
      const searchType = $('.survey_search_option').val()
      if (!input) {
        // ì•„ë¬´ê²ƒë„ ì…ë ¥ì´ ì—†ì„ ë•Œ
        makeSurveyCardList(surveys)
      } else {
        const filteredSurveys = surveys.filter(s => {
          if (searchType === 'title') {
            return s.title.match(input.val())
          } else if (searchType === 'point') {
            return s.point >= (input.val() * 1)
          } else if (searchType === 'end_date') {
          }
        })

        makeSurveyCardList(filteredSurveys)
      }
    }

    const cardClickEventHandler = (e) => {

    }

    $(function () {
      getSurveyList();
      // $('input[name=searchInput]').on('change', asyncSurveySearch)
    })
  </script>
</th:block>