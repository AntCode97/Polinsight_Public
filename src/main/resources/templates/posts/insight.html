<th:block th:include="layout/header" />
<th:block>
  <style>
    .header_wrap {
      background-color: rgb(24, 40, 56) !important;
    }

    .comment-row {
      border: 1px black solid;
    }

    .comment-row > span:not(:first-child) {
      margin-left: 8px;
    }

    .comment-row > a {
      margin-left: 8px;
    }

    .comment_btn {
      color: #2b90d9;
      text-decoration: underline;
    }

    .post-header {
    }

    .post-body {
    }

    .post-wrapper {
      max-width: 1200px;
    }

    .post-content-header {
      display: flex;
    }

    .post-writer {
    }

    .post-title {
    }

    .post-date {
    }
  </style>
  <th:block>
    <div class="flex-wrapper">
      <div class="flex-content">
        <div class="post-wrapper"></div>
        <div name="post-header" class="post-header"></div>
        <div name="post-body" class="post-body"></div>

        <th:block th:include="fragments/comment"></th:block>
      </div>
      <th:block th:include="layout/footer" />
    </div>
  </th:block>
  <script th:src="@{/js/Validator.js}"></script>
  <script th:src="@{/js/CommonUtils.js}"></script>
  <script>
    async function getOneInsightData(postId) {
      let response = await http.get(`/api/post/${postId}`);
      if (response.data.success) {
        return response.data.response;
      } else alert("데이터를 가져오는 중 오류가 발생하였습니다.");
    }

    const makeInsightTemplate = (post) => {
      let postHead = $("div[name=post-header]");
      let headTemplate = $(`<div class="post-content-header"></div>`);
      headTemplate.append(`<span class="post-writer">${post.userName}</span>`);
      headTemplate.append(`<span class="post-title">${post.title}</span>`);
      headTemplate.append(
        `<span class="post-date">${dayAndTime(post.registeredAt)}</span>`
      );
      postHead.append(headTemplate);

      let postBody = $("div[name=post-body]");
      postBody.append(`<div>${post.viewcontent}</div>`);
      post.attaches.forEach((attach) => {
        if (isImageFile(attach.fileName)) {
          postBody.append(
            `<img src="${"http://localhost:8080/uploads/" + attach.fileName}"/>`
          );
        }
      });
    };

    const initInsight = (e) => {
      let postId = `[[${postId}]]`;
      getOneInsightData(postId).then((ins) => {
        makeInsightTemplate(ins);
      });
    };

    $(function () {
      initInsight();
    });
  </script>
</th:block>
