<th:block th:include="layout/header" />
<th:block>
  <style>
    .header_wrap {
      background-color : rgb(24, 40, 56) !important;
    }

    .comment-row {
      border : 1px black solid;
    }

    .comment-row > span:not(:first-child) {
      margin-left : 8px;
    }

    .comment-row > a {
      margin-left : 8px;
    }

    .comment_btn {
      color           : #2B90D9;
      text-decoration : underline;
    }
  </style>
  <th:block>
    <div class="flex-wrapper">
      <div class="flex-content">
        <div name="post-header">

        </div>
        <div name="post-body">

        </div>
        <!--        <div name="comment-input">-->
        <!--          <input name="input-comment-value" type="text">-->
        <!--          <span><button name="add-comment-btn" disabled>답글 달기</button></span>-->
        <!--        </div>-->

        <th:block th:include="fragments/comment"></th:block>
      </div>
      <th:block th:include="layout/footer" />
    </div>
  </th:block>
  <script th:src="@{/js/Validator.js}"></script>
  <script th:src="@{/js/CommonUtils.js}"></script>
  <script>

    async function getOneInsightData(postId) {
      let response = await http.get(`/api/post/${postId}`)
      if (response.data.success) {
        return response.data.response
      } else
        alert('데이터를 가져오는 중 오류가 발생하였습니다.')
    }

    const makeInsightTemplate = post => {
      let postHead = $('div[name=post-header]')
      let headTemplate = $(`<div></div>`)
      headTemplate.append(`<span>${post.userName}</span>`)
      headTemplate.append(`<span>${post.title}</span>`)
      headTemplate.append(`<span>${post.registeredAt}</span>`)
      postHead.append(headTemplate)


      let postBody = $('div[name=post-body]')
      postBody.append(`<div>${post.viewcontent}</div>`)
      post.attaches.forEach(attach => {
        if (isImageFile(attach.fileName)) {
          postBody.append(`<img src="${'http://localhost:8080/files/' + attach.fileName}"/>`)
        }
      })
      // if (post.attaches.length > 0) {
      //   postBody.append(`<img src="${post.thumbnail}" >`)
      // }


      // let commentBody = $('div[name=comment]')
      // post.comments.forEach(comment => {
      //   let bodyTemplate = $('<div class="comment-row"></div>')
      //   bodyTemplate.append(`<span name="author">${comment.writer} 님</span>`)
      //   bodyTemplate.append(`<span name="registryDate">${dayAndTime(comment.lastModifiedAt)}</span>`)
      //   // let replyBtn = $(`<button>답글</button>`).on('click', {}, commentAddEvent)
      //   // let updateBtn = $(`<button>수정</button>`).on('click', {}, commentAddEvent)
      //   // let delBtn = $('<button>삭제</button>').on('click', {id: comment.seq}, commentDeleteEvent)
      //   bodyTemplate.append(`<span>  <a class="comment_btn" href="">수정</a>  <a class="comment_btn" href="">답글</a></span>`)
      //   bodyTemplate.append($(`<span><button type="" name="content" >수정</button></span>`).on('click', {before: before}, commentDeleteEvent))
      //   bodyTemplate.append($(`<span><button type="" name="content" >삭제</button></span>`).on('click', {id: comment.seq}, commentDeleteEvent))
      //   bodyTemplate.append(`<div><span name="content" >${comment.content}</span></div>`)
      //   commentBody.append(bodyTemplate)
      // })
    }

    let insight = {}
    const initInsight = e => {
      let postId = `[[${postId}]]`
      getOneInsightData(postId)
          .then(ins => {
            insight = {...ins}
            makeInsightTemplate(ins);
          })
    }

    $(function () {
      initInsight();
    })

  </script>
</th:block>