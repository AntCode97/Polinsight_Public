<th:block th:include="layout/header" />
<th:block>
  <style>
    .header_wrap {
      background-color : rgb(24, 40, 56) !important;
    }

    .container {
      margin-top : 120px;

    }
  </style>
  <div class="container">
    <div class="board_contents_wrap">
      <div class="main_item">
        <p>Q&A</p>
      </div>
      <div class="main_contents_wrap">
        <div class="post-search">
          <div class="util-search">총 <strong id="total_count"></strong>명의 회원이 있습니다.</div>
          <div class="form-search">
            <div class="tbl-search">
              <div class="box-search">
                <input type="text" name="board_search" />
                <input type="submit" name="board_search_btn" />
              </div>
            </div>
          </div>
        </div>
        <div class="scroll-table">
          <div class="post-row post-th">
            <span>번호</span>
            <a href="#">제목</a>
            <span>작성자</span>
            <span>작성일</span>
            <span>조회수</span>
            <span>첨부파일</span>
          </div>
        </div>
        <div id="pagination"></div>
      </div>
    </div>
    <div id="loading">
      <div class="spinner"></div>
    </div>
  </div>
  <script th:src="@{/js/PostUtils.js}"></script>
  <script>
    async function getPostData(e) {
      let page = !e ? 0 : e.data.page
      const responseData = await http.get('/api/posts?type=QNA', {
        params: {page: page, size: 10}
      })
      const data = responseData.data.response

      return {content: data.content, total: data.totalElements, totalPage: data.totalPages, current: data.number}
    }

    const init = e => {
      const spinner = $('#loading')
      spinner.show()
      getPostData(!e ? 0 : e.data.page).then(obj => {
        $('#total_count').text(obj.total)
        let table = $('.scroll-table')
        table.children('.post-row:not(:first-child)').remove()
        if (obj.total > 0) {
          makePagination(obj.current, obj.totalPage)
          obj.content.forEach(post => {
            table.append(makePostTemplate(post))
          })
        } else
          table.append(`<div class="post-row"><h1>게시물이 없습니다.</h1></div>`)
      })
      spinner.hide()
    }

    $(function () {
      init();
    })

    $(document)
        .on('change keyup', 'input[name=board_search]', function () {

        })
        .on('click', 'input[name=board_search_btn]', function () {
        })
  </script>
</th:block>
<th:block th:include="layout/footer" />