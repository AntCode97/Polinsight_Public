<th:block th:include="layout/header" />
<th:block>
  <style>
    .header_wrap {
      background-color : rgb(24, 40, 56) !important;
    }

    .err_msg {
      display : none;
    }

    .register_wrap {
      margin   : 30px auto 50px;
      position : relative;
      width    : 1000px;
    }

    .register_title {
      color : black;
    }

    .register_title > h1 {
      font-size   : 25px;
      font-weight : bold;
      text-align  : center;
    }

    .register_contents_wrap {
      margin-top : 20px;
    }

    .register_contents_wrap p {
      color         : black;
      font-size     : 18px;
      font-weight   : bold;
      margin-bottom : 8px;
    }

    .register_contents {
      border-top : 1px solid #DDDDDD;
    }

    .register_contents > ul > li {
      align-items   : center;
      border-bottom : 1px solid #DDDDDD;
      display       : flex;
      font-size     : 14px;
      padding       : 10px 0;
    }

    .left_content {
      flex : 1.5;
    }

    .right_content {
      flex : 8.5;
    }

    .left_content > label {
      background  : url('img/etc/icon_required_input.png') right center no-repeat;
      cursor      : pointer;
      font-weight : bold;
      line-height : 18px;
      overflow    : hidden;
      padding     : 0 15px;
    }

    .right_content > input {
      color     : #333333;
      font-size : 14px;
      margin    : 0 3px;
      outline   : none;
    }

    .info_msg, .err_msg {
      font-size   : 12px;
      font-weight : normal;
      padding     : 0 5px;
    }

    .info_msg {
      color : #A9A9A9;
    }

    .err_msg {
      color : red;
    }

    .no_need {
      background-image : url('') !important;
    }

    .pannel_info_contents {
      background-color : #EEEEEE;
      border-radius    : 20px;
      margin           : 40px auto 30px;
      padding          : 15px 0;
      width            : 800px;
    }

    .pannel_info_contents > * {
      color         : black;
      margin-bottom : 15px;
      text-align    : center;
    }

    .pannel_info_contents > h1 {
      font-size : 22px;
    }

    .pannel_info_contents > p {
      font-size   : 16px;
      font-weight : normal;
    }

    .pannel_select {
      align-items     : center;
      display         : flex;
      justify-content : space-between;
      margin          : 0 auto;
      width           : 300px;
    }

    .radio_wrap > label {
      color       : black;
      font-size   : 16px;
      font-weight : bold;
    }

    .btn_wrap {
      align-items     : center;
      display         : flex;
      justify-content : center;
      margin-top      : 30px;
    }

    .btn_submit {
      background-color : #4C99CF;
      border           : none;
      color            : white;
      cursor           : pointer;
      font-size        : 16px;
      font-weight      : bold;
      outline          : none;
      padding          : 7px 45px;
    }

    .right_content > label, .right_content > label > input {
      cursor : pointer;
    }

    .text_input {
      border : 1px solid #DDDDDD;
      height : 32px;
      width  : 300px;
    }

    .right_content select {
      height : 32px;
      width  : 80px;
    }

    #edu {
      width : 170px;
    }

    #jobs {
      width : 120px;
    }

    #industry {
      width : 200px;
    }

    .introduce {
      align-items     : center;
      border-bottom   : 1px solid #DDDDDD;
      display         : flex;
      justify-content : flex-start;
      padding         : 10px 0;
    }

    .introduce > .left_content {
      flex : 2;
    }

    .introduce > .right_content {
      flex : 8;
    }

    .introduce:nth-child(1) {
      padding-top : 0;
    }

    .introduce:nth-child(5) {
      border         : none;
      padding-bottom : 0;
    }
  </style>
  <div class="flex-wrapper">
    <div class="flex-content">
      <div class="register_wrap">
        <form id="addfrm" th:action="@{/moreinfo}" method="POST">
          <div class="register_box">
            <div class="register_title"><h1>패널가입</h1></div>
            <div class="register_contents_wrap">
              <p>추가정보</p>
              <div class="register_contents">
                <ul>
                  <li>
                    <div class="left_content">
                      <label>성별</label>
                    </div>
                    <div class="right_content">
                      <label>
                        <input name="gender" type="radio" value="MALE" checked>
                        남성
                      </label>
                      <label>
                        <input name="gender" type="radio" value="FEMALE">
                        여성
                      </label>
                      <span class="err_msg">성별을 선택해주세요.</span>
                      <span class="info_msg"></span>
                    </div>
                  </li>
                  <li>
                    <div class="left_content">
                      <label for="year">생년월일</label>
                    </div>
                    <div class="right_content">
                      <label for="year">
                        <select id="year" name="year">
                          <option>선택</option>
                        </select>
                        년
                      </label>
                      <label for="month">
                        <select id="month" name="month">
                          <option>선택</option>
                        </select>
                        월
                      </label>
                      <label for="day">
                        <select id="day" name="day">
                          <option>선택</option>
                        </select>
                        일
                      </label>
                      <label>
                        <input checked name="birthType" type="radio" value="양력">
                        양력
                      </label>
                      <label>
                        <input name="birthType" type="radio" value="음력">
                        음력
                      </label>
                      <span class="err_msg"></span>
                      <span class="info_msg"></span>
                    </div>
                  </li>
                  <li>
                    <div class="left_content">
                      <label for="address">거주지</label>
                    </div>
                    <div id="address" class="right_content">
                      <select id="state" name="state">
                        <optgroup label="시도">
                          <option value="광주">광주</option>
                        </optgroup>
                      </select>
                      <select name="city" id="city">
                        <optgroup label="구">
                          <option value="북구">북구</option>
                          <option value="남구">남구</option>
                          <option value="서구">서구</option>
                          <option value="동구">동구</option>
                          <option value="광산구">광산구</option>
                        </optgroup>
                      </select>
                      <span class="err_msg"></span>
                      <span class="info_msg"></span>
                    </div>
                  </li>
                  <li>
                    <div class="left_content">
                      <label for="education">최종학력</label>
                    </div>
                    <div class="right_content">
                      <select id="education" name="education" required>
                        <option>선택</option>
                        <option value="고졸 이하(재학 포함)">고졸 이하(재학 포함)</option>
                        <option value="대학 재학">대학 재학</option>
                        <option value="대학교 졸업(수료 포함)">대학교 졸업(수료 포함)</option>
                        <option value="대학원 이상">대학원 이상</option>
                      </select>
                      <span class="err_msg"></span>
                      <span class="info_msg"></span>
                    </div>
                  </li>
                  <li>
                    <div class="left_content">
                      <label>결혼여부</label>
                    </div>
                    <div class="right_content">
                      <label>
                        <input checked name="marry" type="radio" value="false">
                        미혼
                      </label>
                      <label>
                        <input name="marry" type="radio" value="true">
                        기혼
                      </label>
                      <span class="err_msg"></span>
                      <span class="info_msg"></span>
                    </div>
                  </li>
                  <li>
                    <div class="left_content">
                      <label for="job">직업</label>
                    </div>
                    <div class="right_content">
                      <select id="job" name="job" required>
                        <option>선택</option>
                        <option value="학생">학생</option>
                        <option value="경영직">경영직</option>
                        <option value="공무">공무</option>
                        <option value="회사원">회사원</option>
                        <option value="자영업">자영업</option>
                        <option value="생산기술직">생산기술직</option>
                        <option value="예술인">예술인</option>
                        <option value="프리랜서">프리랜서</option>
                        <option value="무직">무직</option>
                        <option value="기타">기타</option>
                      </select>
                      <span class="err_msg"></span>
                      <span class="info_msg"></span>
                    </div>
                  </li>

                  <li>
                    <div class="left_content">
                      <label for="industry">직종</label>
                    </div>
                    <div class="right_content">
                      <select id="industry" name="industry">
                        <option>선택</option>
                        <option value="제조업">제조업</option>
                        <option value="건설업(인테리어 포함)">건설업(인테리어 포함)</option>
                        <option value="부동산업">부동산업</option>
                        <option value="임대•대여업">임대•대여업</option>
                        <option value="도매 및 소매업(유통업)">도매 및 소매업(유통업)</option>
                        <option value="음식업•외식업">음식업•외식업</option>
                        <option value="운수•여객•숙박업">운수•여객•숙박업</option>
                        <option value="여가 관련 서비스업">여가 관련 서비스업</option>
                        <option value="방송•언론•출판">방송•언론•출판</option>
                        <option value="정보통신업">정보통신업</option>
                        <option value="금융업">금융업</option>
                        <option value="교육 서비스업">교육 서비스업</option>
                        <option value="의료•보건•사회복지">의료•보건•사회복지</option>
                        <option value="시장조사•컨설팅•광고대행업">시장조사•컨설팅•광고대행업</option>
                        <option value="기타">기타</option>
                      </select>
                      <span class="err_msg"></span>
                      <span class="info_msg"></span>
                    </div>
                  </li>

                  <li>
                    <div class="left_content">
                      <label>관심분야</label>
                    </div>
                    <div class="right_content">
                      <div class="type_box">
                        <div class="introduce">
                          <div class="left_content">
                            <label class="no_need">건강, 헬스케어</label>
                          </div>
                          <div class="right_content">
                            <label>
                              <input name="favorite" type="checkbox" value="건강일반">
                              건강일반
                            </label>
                            <label>
                              <input name="favorite" type="checkbox" value="건강식품">
                              건강식품
                            </label>
                            <label>
                              <input name="favorite" type="checkbox" value="다이어트">
                              다이어트
                            </label>
                            <label>
                              <input name="favorite" type="checkbox" value="심리건강">
                              심리건강
                            </label>
                          </div>
                        </div>

                        <div class="introduce">
                          <div class="left_content">
                            <label class="no_need">문화예술, 여가, 스포츠</label>
                          </div>
                          <div class="right_content">
                            <label>
                              <input name="favorite" type="checkbox" value="대중문화">
                              대중문화
                            </label>
                            <label>
                              <input name="favorite" type="checkbox" value="음악">
                              음악
                            </label>
                            <label>
                              <input name="favorite" type="checkbox" value="미술">
                              미술
                            </label>
                            <label>
                              <input name="favorite" type="checkbox" value="공연•축제">
                              공연•축제
                            </label>
                            <label>
                              <input name="favorite" type="checkbox" value="여행">
                              여행
                            </label>
                            <label>
                              <input name="favorite" type="checkbox" value="생활문화">
                              생활문화
                            </label>
                            <label>
                              <input name="favorite" type="checkbox" value="장르예술">
                              장르예술
                            </label>
                            <label>
                              <input name="favorite" type="checkbox" value="레저활동">
                              레저활동
                            </label>
                            <label>
                              <input name="favorite" type="checkbox" value="생활체육">
                              생활체육
                            </label>
                          </div>
                        </div>

                        <div class="introduce">
                          <div class="left_content">
                            <label class="no_need">경제, 경영</label>
                          </div>
                          <div class="right_content">
                            <label>
                              <input name="favorite" type="checkbox" value="제테크">
                              제테크
                            </label>
                            <label>
                              <input name="favorite" type="checkbox" value="창업">
                              창업
                            </label>
                            <label>
                              <input name="favorite" type="checkbox" value="사회적 경제">
                              사회적 경제
                            </label>
                          </div>
                        </div>

                        <div class="introduce">
                          <div class="left_content">
                            <label class="no_need">사회, 복지</label>
                          </div>
                          <div class="right_content">
                            <label>
                              <input name="favorite" type="checkbox" value="사회•복지일반">
                              사회•복지일반
                            </label>
                            <label>
                              <input name="favorite" type="checkbox" value="아동•청소년">
                              아동•청소년
                            </label>
                            <label>
                              <input name="favorite" type="checkbox" value="청년">
                              청년
                            </label>
                            <label>
                              <input name="favorite" type="checkbox" value="노인">
                              노인
                            </label>
                            <label>
                              <input name="favorite" type="checkbox" value="장애인">
                              장애인
                            </label>
                            <label>
                              <input name="favorite" type="checkbox" value="다문화">
                              다문화
                            </label>
                            <label>
                              <input name="favorite" type="checkbox" value="민주인권">
                              민주인권
                            </label>
                            <label>
                              <input name="favorite" type="checkbox" value="노동인권">
                              노동인권
                            </label>
                            <label>
                              <input name="favorite" type="checkbox" value="자원봉사">
                              자원봉사
                            </label>
                          </div>
                        </div>

                        <div class="introduce">
                          <div class="left_content">
                            <label class="no_need">교육</label>
                          </div>
                          <div class="right_content">
                            <label>
                              <input name="favorite" type="checkbox" value="평생교육">
                              평생교육
                            </label>
                            <label>
                              <input name="favorite" type="checkbox" value="초·중·고등교육">
                              초·중·고등교육
                            </label>
                            <label>
                              <input name="favorite" type="checkbox" value="대학교육">
                              대학교육
                            </label>
                          </div>
                        </div>
                      </div>
                      <span class="err_msg"></span>
                      <span class="info_msg"></span>
                    </div>
                  </li>
                </ul>
              </div>
              <div class="pannel_info_msg_wrap"></div>
            </div>
          </div>

          <div class="register_box">
            <div class="register_contents_wrap">
              <p>수신동의</p>
              <div class="register_contents">
                <ul>
                  <li>
                    <div class="left_content">
                      <label class="no_need">SMS 수신동의</label>
                    </div>
                    <div class="right_content">
                      <label>
                        <input name="isSmsReceive" type="radio" value="true" checked>
                        동의함
                      </label>
                      <label>
                        <input name="isSmsReceive" type="radio" value="false">
                        동의안함
                      </label>
                      <span class="err_msg">동의하지 않을 시 설문조사 안내를 받으실 수 없습니다.</span>
                      <span class="info_msg"></span>
                    </div>
                  </li>

                  <li>
                    <div class="left_content">
                      <label class="no_need">이메일 수신동의</label>
                    </div>
                    <div class="right_content">
                      <label>
                        <input name="isEmailReceive" type="radio" value="true" checked>
                        동의함
                      </label>
                      <label>
                        <input name="isEmailReceive" type="radio" value="false">
                        동의안함
                      </label>
                      <span class="err_msg">동의하지 않을 시 설문조사 안내를 받으실 수 없습니다.</span>
                      <span class="info_msg"></span>
                    </div>
                  </li>
                </ul>
              </div>
              <div class="btn_wrap">
                <button name="panel_signup" class="btn_submit" type="submit">JOIN US</button>
              </div>
            </div>
          </div>
        </form>
      </div>
    </div>
    <th:block th:include="layout/footer" />
  </div>
  <script>
    const checkRequiredValue = info => {
      let arr = ['birth', 'gender', 'birthType', 'education', 'marry', 'job', 'industry', 'address', 'city', 'state', 'isEmailReceive', 'isSmsReceive', 'year', 'month', 'day']

      for (let idx in arr) {
        let key = arr[idx]
        if (!info[key] || info[key].includes('선택')) {
          console.log('key: ' + key + ', value: ' + info[key])
          return false;
        }
      }
      return !(!Array.isArray(info['favorite']) || info['favorite'].length <= 0);
    }

    const inputChangeHandler = e => {
      let name = e.target.name
      let value = e.target.value
      if (name === 'favorite') {
        if (userInfo[name].includes(value))
          userInfo[name].pop(value)
        else
          userInfo[name].push(value)
      } else {
        userInfo[name] = value
      }
    }

    const userInfo = {
      favorite: []
    }

    $(function () {
      setDateValue()
      $("#month").on('change', setDay)

      $('input[type=radio]:checked').on('click', inputChangeHandler).trigger('click')

      $('input[name=gender]').trigger('change')
      $('input').on('change', inputChangeHandler)
      $('select').on('change', inputChangeHandler).trigger('change')

      $("button[name=panel_signup]").on('click', e => {
        e.preventDefault()
        e.returnValue = false
        console.log(userInfo)
        userInfo['address'] = addressParser(userInfo['state'], userInfo['city'])
        userInfo['birth'] = dateParser(userInfo['year'], userInfo['month'], userInfo['day'])

        if (checkRequiredValue(userInfo)) {
          http
              .post('/panel_signup', userInfo)
              .then(res => {
                if (res.data.success) {
                  location.replace("/success_panel")
                }
              })
              .catch(err => {
                console.log(err)
                alert('가입 중 문제가 발생하였습니다.\n관리자에게 문의해주세요.')
              })
        } else {
          alert('필수 입력값을 모두 입력해주세요')
        }

      })
    })
  </script>
</th:block>